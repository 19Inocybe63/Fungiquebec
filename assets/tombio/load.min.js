!function(n){"use strict";window.console||(window.console={log:function(){}}),String.prototype.endsWith||(String.prototype.endsWith=function(e,o){return o<this.length?o|=0:o=this.length,this.substr(o-e.length,e.length)===e}),String.prototype.startsWith||(String.prototype.startsWith=function(e,o){return this.substr(o||0,e.length)===e}),n.opts||(n.opts={}),"undefined"!=typeof tombiover&&(n.opts.tombiover=tombiover),"undefined"!=typeof tombiopath&&(n.opts.tombiopath=tombiopath),"undefined"!=typeof tombiokbpath&&(n.opts.tombiokbpath=tombiokbpath),n.opts.tombiover||(n.opts.tombiover="none"),n.metadata={title:"Tom.bio Framework for ID visualisations",year:"2016",authors:"Burkmar, R.",publisher:"Field Studies Council",location:"Shrewsbury, England",contact:"richardb@field-studies-council.org",version:"1.6.0"};var s=["vis1","vis2","vis5","vis4","vis3"];n.includedTools=[];var r=n.jsFiles={add:function(e,o,i){n.jsFiles[e]=Object.create(n.jsFile),n.jsFiles[e].init(e,o,i)},asArray:function(){var e=[];for(var o in n.jsFiles)n.jsFiles.hasOwnProperty(o)&&e.push(n.jsFiles[o]);return e}};function a(e){var o=e.lastIndexOf("."),i=e.substr(o+1),s=e.substr(0,o);return s.endsWith(".min")?e:s+".min."+i}function t(){n.taxa&&n.characters&&n.values&&n.kbmetadata&&n.media&&(console.log("%cKB is loaded!","color: blue"),jQuery.get(n.opts.tombiopath+"import.html?ver="+n.opts.tombiover,function(e){jQuery("#tombiod3vis").html(e),r.tombiovis.loadReady(),n.loadScripts(function(){n.hideDownloadSpinner(),n.loadComplete()})}))}n.jsFile={init:function(e,o,i){this.id=e,this.file=n.opts.tombiopath+o,this.dependencies=[],this.css=[],this.load=!1,this.loading=!1,this.loaded=!1,this.toolName=i},addCSS:function(e){this.css.push(n.opts.tombiopath+e)},loadReady:function(){this.load=!0,this.dependencies.forEach(function(e){e.loadReady()})}},n.loadScripts=function(e){var o=r.asArray().filter(function(e){if(e.load&&!e.loading&&!e.loaded){for(var o=0;o<e.dependencies.length;o++)if(!e.dependencies[o].loaded)return!1;return!0}});if(0==o.length){var i=r.asArray().filter(function(e){if(e.load&&!e.loaded)return!0});return 0<i.length?(console.log("%cLoading - something's gone wrong, these files were not loaded...","color: red"),void i.forEach(function(e){console.log(e.id,"load: "+e.load,"loading: "+e.loading,"loaded: "+e.loaded)})):void e()}var s=o[0];s.loading=!0;var t,d=document.createElement("script");t=n.opts.devel?s.file:a(s.file),d.src=t,d.onreadystatechange=d.onload=function(){!d.readyState||/loaded|complete/.test(d.readyState)?(console.log("%cLoading - javascript file loaded: "+t,"color: blue"),s.loaded=!0,s.loading=!1,n.loadScripts(e)):console.log("%cLoading - javascript file load failed: "+t,"color: red")},document.querySelector("head").appendChild(d),s.css.forEach(function(e){var o,i=document.createElement("link");i.rel="stylesheet",i.type="text/css",o=n.opts.devel?e:a(e),i.href=o,document.querySelector("head").appendChild(i),console.log("%cLoading - CSS file added to head: "+o,"color: blue")})},n.showDownloadSpinner=function(){var e=document.createElement("div");e.id="downloadspin";var o=document.getElementById("tombiod3");o.insertBefore(e,o.firstChild);new Spinner({lines:13,length:28,width:14,radius:42,scale:.8,corners:1,color:"#000",opacity:.15,rotate:0,direction:1,speed:1,trail:60,fps:20,zIndex:2e9,className:"spinner",top:"49%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"}).spin(e)},n.hideDownloadSpinner=function(){var e=document.getElementById("tombiod3"),o=document.getElementById("downloadspin");e.removeChild(o)},r.add("jquery","dependencies/jquery-3.1.1/jquery-3.1.1.min.js"),r.add("jqueryui","dependencies/jquery-ui-1.12.1/jquery-ui.min.js"),r.jqueryui.addCSS("dependencies/jquery-ui-1.12.1/jquery-ui.min.css"),r.jqueryui.addCSS("dependencies/jquery-ui-1.12.1/jquery-ui.theme.min.css"),r.add("d3","dependencies/d3-4.10.0/d3.v4.min.js"),r.add("spinner","dependencies/spin.min.js"),r.add("mousewheel","dependencies/jquery.mousewheel.min.js"),r.add("touchpunch","dependencies/jquery.ui.touch-punch.min.js"),r.add("hammer","dependencies/hammer.min.js"),r.add("pqselect","dependencies/pqselect-1.3.2/pqselect.min.js"),r.pqselect.addCSS("dependencies/pqselect-1.3.2/pqselect.min.css"),r.add("pqgrid","dependencies/pqgrid-2.1.0/pqgrid.min.js"),r.pqgrid.addCSS("dependencies/pqgrid-2.1.0/pqgrid.min.css"),r.add("tombiovis","tombiovis.js?ver="+n.opts.tombiover),r.tombiovis.addCSS("tombiovis.css"),r.add("kbchecks","kbchecks.js?ver="+n.opts.tombiover),r.add("score","score.js?ver="+n.opts.tombiover),r.add("taxonselect","taxonselect.js?ver="+n.opts.tombiover),r.taxonselect.addCSS("taxonselect.css"),r.add("visP","visP.js?ver="+n.opts.tombiover),r.add("vis1","vis1/vis1.js?ver="+n.opts.tombiover,"Two-column key"),r.vis1.addCSS("vis1/vis1.css"),r.add("vis2","vis2/vis2.js?ver="+n.opts.tombiover,"Single-column key"),r.vis2.addCSS("vis2/vis2.css"),r.add("vis3","vis3/vis3.js?ver="+n.opts.tombiover,"Side by side comparison"),r.vis3.addCSS("vis3/vis3.css"),r.add("vis4","vis4/vis4.js?ver="+n.opts.tombiover,"Full taxon details"),r.vis4.addCSS("vis4/vis4.css"),r.add("vis5","vis5/vis5.js?ver="+n.opts.tombiover,"Circle-pack key"),r.vis5.addCSS("vis5/vis5.css"),r.add("visEarthworm","visEarthworm/visEarthworm.js?ver="+n.opts.tombiover,!0),r.visEarthworm.addCSS("visEarthworm/visEarthworm.css"),r.visP.dependencies=[r.mousewheel,r.hammer],r.taxonselect.dependencies=[r.d3,r.jquery,r.jqueryui],r.pqgrid.dependencies=[r.jquery,r.jqueryui],r.pqselect.dependencies=[r.jquery,r.jqueryui],r.tombiovis.dependencies=[r.jquery,r.jqueryui,r.kbchecks,r.pqselect],r.vis1.dependencies=[r.d3,r.jquery,r.jqueryui,r.visP,r.score],r.vis2.dependencies=[r.d3,r.jquery,r.jqueryui,r.visP,r.score],r.vis3.dependencies=[r.d3,r.jquery,r.jqueryui,r.visP,r.taxonselect,r.pqgrid,r.score],r.vis4.dependencies=[r.d3,r.jquery,r.jqueryui,r.visP,r.taxonselect],r.vis5.dependencies=[r.d3,r.jquery,r.jqueryui,r.visP,r.score],r.visEarthworm.dependencies=[r.d3,r.jquery,r.jqueryui],n.startLoad=function(){r.spinner.loadReady(),n.loadScripts(function(){n.showDownloadSpinner(),r.jquery.loadReady(),n.loadScripts(function(){jQuery(document).ready(function(){jQuery("#tombiod3").append(jQuery('<div id="tombiod3vis">'))}),r.d3.loadReady(),n.loadScripts(function(){!function(){var e="none";function o(e){if(""!=e[Object.keys(e)[0]]&&"#"!=e[Object.keys(e)[0]].substr(0,1)){for(var o in e)e.hasOwnProperty(o)&&(e[o]=e[o]?e[o].trim():"");return e}return null}d3.csv(n.opts.tombiokbpath+"taxa.csv?"+e,function(e){return o(e)},function(e){n.taxa=e,console.log("%cLoading - kb taxa loaded","color: blue"),t()}),d3.csv(n.opts.tombiokbpath+"characters.csv?"+e,function(e){return o(e)},function(e){n.characters=e,n.characters.columns=null,console.log("%cLoading - kb characters loaded","color: blue"),t()}),d3.csv(n.opts.tombiokbpath+"values.csv?"+e,function(e){return o(e)},function(e){n.values=e,console.log("%cLoading - kb values loaded","color: blue"),t()}),d3.csv(n.opts.tombiokbpath+"config.csv?"+e,function(e){return o(e)},function(e){n.kbconfig={},n.kbmetadata={},n.kbreleaseHistory=[];var i=[];e.forEach(function(e){if("config"==e.Type&&(n.kbconfig[e.Key]=e.Value),n.opts.selectedTool,"excludedDefaultTools"==e.Key&&""!=e.Value.trim()){var o=e.Value.split(",");o.forEach(function(e){i.push(e.trim())})}if("otherIncludedTools"==e.Key&&""!=e.Value.trim()){var o=e.Value.split(",");o.forEach(function(e){n.includedTools.push(e.trim())})}"metadata"==e.Type&&(n.kbmetadata[e.Key]=e.Value),"release"==e.Key&&n.kbreleaseHistory.push(e)}),s.forEach(function(e){-1==i.indexOf(e)&&n.includedTools.push(e)}),n.opts.tools&&Array.isArray(n.opts.tools)&&0<n.opts.tools.length&&(n.includedTools=n.opts.tools),console.log("%cLoading - kb metadata loaded","color: blue"),t()}),d3.csv(n.opts.tombiokbpath+"media.csv?"+e,function(e){return o(e)},function(e){n.media=e,console.log("%cLoading - kb media loaded","color: blue"),t()})}()})})})},n.opts.loadWait||n.startLoad()}(this.tombiovis?this.tombiovis:this.tombiovis={});