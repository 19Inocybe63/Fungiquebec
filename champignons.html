---
layout: wrap
title: Champignons
permalink: /champignons/
---

<script>
    function hideAllChampignons() {
        $('#search-results').html("");
    }

    function showResults(results, facets) {
        var resultCountDiv = $('<div>');
        resultCountDiv.text(results.length + " champignons trouv√©s");
        $('#search-results').append(resultCountDiv);

        for (var i = 0; i < results.length; ++i) {
            var result = results[i];
            if (!result) {
                continue;
            }
            var doc = champignons[(result.ref * 1) - 1];
            if (!doc) {
                continue;
            }

            var searchResultDiv = $('<div>');
            search
            var searchResultLink = $('<a>');
            searchResultLink.html("<i>" + doc.nom + "</i>");
            searchResultLink.attr('href', doc.url);
            searchResultDiv.append(searchResultLink);

            $('#search-results').append(searchResultDiv);
        }

        for (var i = 0; i < facets.length; ++i) {
            var facetResult = facets[i];
            var facet = searchHandler.facets[facetResult.field];
            var facetSelectElement = $('#' + facetResult.field);
            facetSelectElement.html('');

            var option = $('<option>');
            option.attr('value', 'tous');
            option.text('Tous');
            facetSelectElement.append(option);

            for (var j = 0; j < facetResult.results.length; ++j) {
                var item = facetResult.results[j]
                option = $('<option>');
                option.attr('value', item.value);
                if (item.value === facet.selectedValue) {
                    option.attr('selected', 'selected');
                }
                option.text(item.value + " (" + item.count + ")");
                facetSelectElement.append(option);
            }
        }
    }

    function onSearchBoxKeyUp(event) {
        if (event.keyCode == 13) {
            search();
        }
    }

    function onFacetSelectionChange(event) {
        var dropdown = event.target;
        var champ = dropdown.id;
        var selectedValue = dropdown.selectedOptions[0].value;
        var facet = searchHandler.facets[champ];

        if (selectedValue === "tous") {
            facet.selectedValue = undefined;
        } else {
            facet.selectedValue = selectedValue;
        }

        search();
    }

    function search() {
        var searchbox = $('#searchbox')[0];
        if (searchbox) {
            searchHandler.query = searchbox.value;
        }

        searchHandler.filters = {};

        var attributeSelectorElements = $('.attributeSelector');
        var attributeKeywordsElements = $('.attributeKeywords');
        for (var i = 0; i < attributeSelectorElements.length; ++i) {
            var attributeSelectorElement = attributeSelectorElements[i];
            var attributeKeywordsElement = attributeKeywordsElements[i];

            if (attributeKeywordsElement.value) {
                searchHandler.filters[attributeSelectorElement.selectedOptions[0].value] = attributeKeywordsElement.value;
            }
        }

        searchHandler.search();
    }

    function appendAttributeSelector() {
        var attributeSelectors = $('#attributeSelectors');
        var attributeSelectorDiv = $('<div>');

        var attributeSelector = $('<select>');
        attributeSelector.attr('class', 'attributeSelector');
        for (var i = 0; i < champsChampignons.length; ++i) {
            var champ = champsChampignons[i];
            option = $('<option>');
            option.attr('value', champ.name);
            option.text(champ.label);
            attributeSelector.append(option);
        }
        attributeSelectorDiv.append(attributeSelector);

        var spanElement = $('<span>');
        spanElement.text(' : ');
        attributeSelectorDiv.append(spanElement);

        var attributeKeywordsElement = $('<input>');
        attributeKeywordsElement.attr('type', 'text');
        attributeKeywordsElement.attr('class', 'attributeKeywords');
        attributeSelectorDiv.append(attributeKeywordsElement);

        attributeSelectors.append(attributeSelectorDiv);
    }
</script>

<div class="container mtb">
    <div class="row">
        <div class="col-lg-12">
            <form id="searchform" onsubmit="return false">
                <div>
                    <input id="searchbox" type="text" placeholder="Recherche..." onkeyup="onSearchBoxKeyUp(event)" />
                </div>
                <div>
                    {% for champ in site.champs-details %}
                        {% if champ.search == "facet" %}
                        <div>
                            {{ champ.label }} :
                            <select name="{{ champ.name | replace: "-", "_" }}" id="{{ champ.name | replace: "-", "_" }}" onchange="onFacetSelectionChange(event)"></select>
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
                <div id="attributeSelectors">
                </div>
                <div>
                    <button onclick="appendAttributeSelector()">Ajouter un champ</button>
                </div>
                <div>
                    <button onclick="search()">Rechercher</button>
                </div>
            </form>

            <div id="search-results">

            </div>
        </div>
    </div><!--/row -->
</div><!--/container -->

<script src="{{ "/assets/js/elasticlunr.min.js" | prepend: site.baseurl }}"></script>
<script src="{{ "/assets/js/lunr.stemmer.support.js" | prepend: site.baseurl }}"></script>
<script src="{{ "/assets/js/lunr.fr.js" | prepend: site.baseurl }}"></script>
<script src="{{ "/assets/js/searchHandler.js" | prepend: site.baseurl }}"></script>
<script src="{{ "/assets/js/champignons.js" | prepend: site.baseurl }}"></script>
<script>
    function onDomReady() {
        searchHandler.index = indexChampignons;
        searchHandler.allResults = champignons;
        searchHandler.showResults = showResults;
        searchHandler.hideAllResults = hideAllChampignons;
        searchHandler.facets = facetsChampignons;
        searchHandler.initialize("");
        appendAttributeSelector();
    }
</script>